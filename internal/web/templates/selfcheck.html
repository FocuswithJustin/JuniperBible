{{template "header" .}}

<nav aria-label="breadcrumb">
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/capsule/{{.Capsule.Path}}">{{.Capsule.Name}}</a></li>
    <li>Selfcheck</li>
  </ul>
</nav>

<article>
  <header>
    <h2>Selfcheck</h2>
    <p class="meta">{{.Capsule.Name}} ({{.Capsule.SizeHuman}})</p>
  </header>

  {{if .Result}}
    {{if .Result.Success}}
    {{template "alertSuccess" (printf "<strong>All checks passed!</strong> Plan: %s | Duration: %s" .Result.PlanName .Result.Duration)}}
    {{else}}
    {{template "alertError" (printf "<strong>Some checks failed!</strong> %s" .Result.Message)}}
    {{end}}

    {{if .Result.CheckResults}}
    <h3>Check Results</h3>
    <div class="table-responsive">
      <table>
        <caption style="caption-side: top; text-align: left; font-weight: bold; padding-bottom: 0.5rem;">Check Results</caption>
        <thead>
          <tr>
            <th>Check</th>
            <th>Expected</th>
            <th>Actual</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {{range .Result.CheckResults}}
          <tr>
            <td>{{.Name}}</td>
            <td class="meta">{{.Expected}}</td>
            <td class="meta">{{.Actual}}</td>
            <td>
              {{if .Passed}}
              <span class="tag" style="background: #28a745; color: white;">PASS</span>
              {{else}}
              <span class="tag" style="background: #dc3545; color: white;">FAIL</span>
              {{end}}
            </td>
          </tr>
          {{end}}
        </tbody>
      </table>
    </div>
    {{end}}
    <hr>
  {{end}}

  <h3>Run Selfcheck</h3>
  <form method="post">
    <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
    <label for="plan">
      Select Plan
      <select id="plan" name="plan" required>
        {{range .Plans}}
        <option value="{{.Name}}">{{.Name}} - {{.Description}}</option>
        {{end}}
      </select>
    </label>
    <button type="submit">Run Selfcheck</button>
  </form>
</article>

<article>
  <header>
    <h3>Available Plans</h3>
  </header>
  <div class="table-responsive">
    <table>
      <caption style="caption-side: top; text-align: left; font-weight: bold; padding-bottom: 0.5rem;">Available Plans</caption>
      <thead>
        <tr>
          <th>Plan</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
        {{range .Plans}}
        <tr>
          <td><strong>{{.Name}}</strong></td>
          <td>{{.Description}}</td>
        </tr>
        {{end}}
      </tbody>
    </table>
  </div>
</article>

<div class="btn-group">
  {{template "btnSecondary" dict "label" "Back to Capsule" "href" (printf "/capsule/%s" .Capsule.Path)}}
  {{template "btnSecondary" dict "label" "Verify" "href" (printf "/verify/%s" .Capsule.Path)}}
  {{template "btnSecondary" dict "label" "Export" "href" (printf "/export/%s" .Capsule.Path)}}
</div>

{{template "footer" .}}
