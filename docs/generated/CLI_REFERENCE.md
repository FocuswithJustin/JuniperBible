# CLI Reference

This document is auto-generated by `capsule docgen cli`.

## Synopsis

```
capsule <command> [arguments]
```

## Core Commands

### ingest

Ingest a file into a new capsule

**Usage:**
```
capsule ingest <path> --out <capsule.tar.xz>
```

**Example:**
```bash
capsule ingest myfile.zip --out myfile.capsule.tar.xz
```

### export

Export an artifact from a capsule

**Usage:**
```
capsule export <capsule> --artifact <id> --out <path>
```

**Example:**
```bash
capsule export my.capsule.tar.xz --artifact main --out restored.zip
```

### verify

Verify capsule integrity (all hashes match)

**Usage:**
```
capsule verify <capsule>
```

**Example:**
```bash
capsule verify my.capsule.tar.xz
```

### selfcheck

Run self-check verification plan

**Usage:**
```
capsule selfcheck <capsule> [--plan <plan-id>] [--json]
```

**Example:**
```bash
capsule selfcheck my.capsule.tar.xz --plan identity-bytes
```

## Plugin Commands

### plugins

List available plugins

**Usage:**
```
capsule plugins [--dir <path>]
```

**Example:**
```bash
capsule plugins
```

### detect

Detect file format using plugins

**Usage:**
```
capsule detect <path> [--plugin-dir <path>]
```

**Example:**
```bash
capsule detect myfile.xml
```

### enumerate

Enumerate contents of archive

**Usage:**
```
capsule enumerate <path> [--plugin-dir <path>]
```

**Example:**
```bash
capsule enumerate myfile.zip
```

## IR Commands

### extract-ir

Extract Intermediate Representation from a file

**Usage:**
```
capsule extract-ir <path> --format <format> --out <ir.json>
```

**Example:**
```bash
capsule extract-ir bible.usfm --format usfm --out bible.ir.json
```

### emit-native

Emit native format from IR

**Usage:**
```
capsule emit-native <ir.json> --format <format> --out <path>
```

**Example:**
```bash
capsule emit-native bible.ir.json --format osis --out bible.osis
```

### convert

Convert file to different format via IR

**Usage:**
```
capsule convert <path> --to <format> --out <path>
```

**Example:**
```bash
capsule convert bible.usfm --to osis --out bible.osis
```

### ir-info

Display IR structure summary

**Usage:**
```
capsule ir-info <ir.json> [--json]
```

**Example:**
```bash
capsule ir-info bible.ir.json
```

## Tool Commands

### run

Run a tool plugin with Nix executor

**Usage:**
```
capsule run <tool> <profile> [--input <path>] [--out <dir>]
```

**Example:**
```bash
capsule run libsword list-modules --input ./kjv
```

### tool-run

Run tool on artifact and store transcript

**Usage:**
```
capsule tool-run <capsule> <artifact> <tool> <profile>
```

**Example:**
```bash
capsule tool-run kjv.capsule.tar.xz main libsword render-all
```

### tool-list

List available tools in contrib/tool

**Usage:**
```
capsule tool-list [<contrib-dir>]
```

**Example:**
```bash
capsule tool-list
```

### tool-archive

Create tool archive capsule from binaries

**Usage:**
```
capsule tool-archive <tool-id> --version <ver> --bin <name>=<path> --out <capsule>
```

**Example:**
```bash
capsule tool-archive diatheke --version 1.8.1 --bin diatheke=/usr/bin/diatheke --out diatheke.capsule.tar.xz
```

## Behavioral Testing Commands

### runs

List all runs in a capsule

**Usage:**
```
capsule runs <capsule>
```

**Example:**
```bash
capsule runs kjv.capsule.tar.xz
```

### compare

Compare transcripts between two runs

**Usage:**
```
capsule compare <capsule> <run1> <run2>
```

**Example:**
```bash
capsule compare kjv.capsule.tar.xz run-1 run-2
```

### golden

Save or check golden transcript hash

**Usage:**
```
capsule golden <capsule> <run> [--save <file>] [--check <file>]
```

**Example:**
```bash
capsule golden kjv.capsule.tar.xz run-1 --save golden.sha256
```

### test

Run tests against golden hashes

**Usage:**
```
capsule test <fixtures-dir> [--golden <dir>]
```

**Example:**
```bash
capsule test testdata/fixtures
```

## Documentation Commands

### docgen

Generate documentation from plugins and CLI.

**Usage:**
```
capsule docgen <subcommand> [--output <dir>]
```

**Subcommands:**
- `plugins` - Generate PLUGINS.md
- `formats` - Generate FORMATS.md
- `cli` - Generate CLI_REFERENCE.md
- `all` - Generate all documentation

**Example:**
```bash
capsule docgen all --output docs/
```

## Other Commands

### version

Print version information.

```bash
capsule version
```

### help

Show help message.

```bash
capsule help
```
